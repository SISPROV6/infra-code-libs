<!-- #region HEADER -->
<lib-header
  [breadcrumbList]=" this.module == 'Corporativo' ? ['Corporativo', 'Log', 'Log API'] : ['Configuração ERP', 'Log', 'Log API' ]"
  [breadcrumbList]="['Configuração ERP', 'Log']"
  pageTitle="Log API"
/>
<!-- #endregion HEADER -->

<!-- #region Corpo -->
<div class="glb-main-container p-3">
  <!-- #region SEARCH AND FILTERS -->
  <div class="col-12 row">
    <app-search-filters
      (_executeGetBySearch)="getLogsList($event.toString())"
      (_EMIT_CLEAR_EXTRA_INPUT)="
        dateInicioIni = null;
        dateInicioFin = null;
        dateFinalIni = null;
        dateFinalFin = null;
        isError = true;
        isSlow = false;
        resetPagination(this.$logList)
      "
      placeholder="Digite o id, usuário, método ou API do Log"
      class="mb-4"
      [useIsActive]="false"
    >
    </app-search-filters>

  </div>
  <div class="row">
    <div class="col-6">
        <label class="form-label">Data/Hora ocorrência:</label>
        <div class="input-group">
          <input class="form-control" type="datetime-local" [(ngModel)]="dateInicioIni">
        <span class="input-group-text">Até</span>
        <input class="form-control" type="datetime-local" [(ngModel)]="dateInicioFin">
      </div>
    </div>
    <div class="col-6">
        <label class="form-label">Data/Hora final ocorrência:</label>
        <div class="input-group">

        <input class="form-control" type="datetime-local" [(ngModel)]="dateFinalIni">
        <span class="input-group-text">Até</span>
        <input class="form-control" type="datetime-local" [(ngModel)]="dateFinalFin">
      </div>
    </div>
  </div>
  <!-- #endregion SEARCH AND FILTERS -->
  <div class="mt-4">
    <lib-table [list]="$logList" [counts]="[ 5,15,25 ]" paginationID="simpleTable" *ngIf="!this.isListLoading; else loading"
    [headers]="[
        { name: 'Id', widthClass: 'col-1', orderColumn:'Id' },
        { name: 'Usuário', widthClass: 'col-1', orderColumn:'NomeUsuarioLogado' },
        { name: 'API', widthClass: 'col-2', orderColumn:'ApiOrigem' },
        { name: 'Data/Hora ocorrência', widthClass: 'col-2', orderColumn:'DtHora' },
        { name: 'Data/Hora final ocorrência', widthClass: 'col-3', orderColumn:'DtHoraFim' },
        { name: 'Método de origem', widthClass: 'col-2', orderColumn:'MetodoOrigem' },
        { name: '', widthClass: 'col-1', customClasses: 'text-end' }
    ]"
    (itemsPerPageChange)="itemsPerPage = $event"
    (pageChange)="page = $event" >
<div upperContent>
<div class="d-flex">
        <div class="form-check form-switch">
          <label class="form-check-label" for="inputSearchDN">Erro</label>
          <input
            class="form-check-input"
            [(ngModel)]="isError"
            type="checkbox"
            role="switch"
            id="inputSearchDN"
          />
      </div>

        <div class="form-check form-switch ms-3">
          <label class="form-check-label" for="inputSearchDN">Lento</label>
          <input
            class="form-check-input"
            [(ngModel)]="isSlow"
            type="checkbox"
            role="switch"
            id="inputSearchDN"
          />
      </div>
    </div>
</div>
    @for (logs of $logList! | paginate: { id: 'simpleTable', itemsPerPage: itemsPerPage, currentPage: page }; track logs) {
        <tr innerRows class="align-middle">
           <td class="align-middle">{{ logs.Id }}</td>
          <td class="align-middle">{{ logs.NomeUsuarioLogado }}</td>
          <td class="align-middle">{{ logs.ApiOrigem }}</td>
          <td class="align-middle">
            {{ logs.DtHora | date : "dd/MM/yyyy - HH:mm:ss" }}
          </td>
          <td class="align-middle">
            {{ logs.DtHoraFim | date : "dd/MM/yyyy - HH:mm:ss" }}
          </td>
          <td class="align-middle">{{ logs.MetodoOrigem }}</td>
          <td class="acoes-column align-middle">
            <a
              [routerLink]="['/logs-api/detalhes', logs.Id]"
              target="_blank"
              (click)="setEstado()"
            >
              <lib-icon
                iconName="olho"
                tooltip="Visualizar"
                [iconColor]="this.module == 'Corporativo' ? 'blue' : 'gray'"
                class="glb-cursor-pointer text-primary"
              />
            </a>
          </td>
        </tr>
    }
  </lib-table>
  </div>


  <!-- #region SPINNER -->
  <ng-template #loading>
    <div class="d-flex justify-content-center">
          <lib-spinner></lib-spinner>

    </div>
  </ng-template>
  <!-- #endregion SPINNER -->
  <!-- #region EMPTY LIST -->
  <!-- #endregion EMPTY LIST -->
</div>
